<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>easy-preprocess-av-bag</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Manual";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> easy-preprocess-av-bag
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Manual</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#synopsis">SYNOPSIS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#description">DESCRIPTION</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#processing">Processing</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installation-and-configuration">INSTALLATION AND CONFIGURATION</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#building-from-source">BUILDING FROM SOURCE</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">easy-preprocess-av-bag</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Manual</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/DANS-KNAW/easy-preprocess-av-bag/edit/master/docs/index.md"> Edit on DANS-KNAW/easy-preprocess-av-bag</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="easy-preprocess-av-bag">easy-preprocess-av-bag<a class="headerlink" href="#easy-preprocess-av-bag" title="Permanent link">&para;</a></h1>
<p>Preprocesses a bag exported by easy-fedora-to-bag which contains AV materials.</p>
<h2 id="synopsis">SYNOPSIS<a class="headerlink" href="#synopsis" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code>easy-preprocess-av-bag &lt;bag-inbox&gt; &lt;bag-outbox&gt;
</code></pre>

<h2 id="description">DESCRIPTION<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Preprocesses a bag exported by <a href="https://github.com/DANS-KNAW/easy-fedora-to-bag">easy-fedora-to-bag</a> which contains AV materials. The resulting bags are then further processed to deposits
by <a href="https://github.com/DANS-KNAW/easy-convert-bag-to-deposit">easy-convert-bag-to-deposit</a> and ingested into a Data Station.</p>
<h3 id="processing">Processing<a class="headerlink" href="#processing" title="Permanent link">&para;</a></h3>
<p>The input is a directory containing bags exported from EASY by <code>easy-fedora-to-bag</code>. The output is a directory containing the preprocessed bags. Each input bag
results in two or three output bags, corresponding to one to three versions of the dataset to be created in the Data Station:</p>
<ol>
<li>The original dataset, completed with files that were included as pseudo-files in EASY. A pseudo-files was a reference to a file stored in the dark archive.</li>
<li>A new version of the dataset, with the files that were set to accessibility/visibility "NONE" removed.</li>
<li>A third version of the dataset, with the streaming copies of the audio and video files added.</li>
</ol>
<p>Where to find the content of the pseudo-files and streaming files is specified in the configuration file:</p>
<pre><code class="language-yaml">pseudoFileSources:
  darkarchiveDir: # ...location of directory containing dark archive files
  springfieldDir: # ...location of directory containing files from Springfield (streaming copies)
  path: # ...location of a CSV file detailing where to find the files  


</code></pre>
<p>The CSV file should have the following format:</p>
<table>
<thead>
<tr>
<th>easy-file-id</th>
<th>easy-dataset-id</th>
<th>path-in-darcharchive-dir</th>
<th>path-in-springfield-dir</th>
</tr>
</thead>
<tbody>
<tr>
<td>easy-file:12345</td>
<td>easy-dataset:67890</td>
<td>path/to/file1</td>
<td>path/to/file2</td>
</tr>
<tr>
<td>easy-file:23456</td>
<td>easy-dataset:67890</td>
<td>path/to/file3</td>
<td>path/to/file4</td>
</tr>
</tbody>
</table>
<h2 id="installation-and-configuration">INSTALLATION AND CONFIGURATION<a class="headerlink" href="#installation-and-configuration" title="Permanent link">&para;</a></h2>
<p>Currently, this project is built as an RPM package for RHEL8 and later. The RPM will install the binaries to
<code>/opt/dans.knaw.nl/easy-preprocess-av-bag</code> and the configuration files to <code>/etc/opt/dans.knaw.nl/easy-preprocess-av-bag</code>.</p>
<p>For installation on systems that do no support RPM and/or systemd:</p>
<ol>
<li>Build the tarball (see next section).</li>
<li>Extract it to some location on your system, for example <code>/opt/dans.knaw.nl/easy-preprocess-av-bag</code>.</li>
<li>Start the service with the following command
   <code>/opt/dans.knaw.nl/easy-preprocess-av-bag/bin/easy-preprocess-av-bag server /opt/dans.knaw.nl/easy-preprocess-av-bag/cfg/config.yml</code></li>
</ol>
<h2 id="building-from-source">BUILDING FROM SOURCE<a class="headerlink" href="#building-from-source" title="Permanent link">&para;</a></h2>
<p>Prerequisites:</p>
<ul>
<li>Java 17 or higher</li>
<li>Maven 3.3.3 or higher</li>
<li>RPM</li>
</ul>
<p>Steps:</p>
<pre class="codehilite"><code>git clone https://github.com/DANS-KNAW/easy-preprocess-av-bag.git
cd easy-preprocess-av-bag 
mvn clean install
</code></pre>

<p>If the <code>rpm</code> executable is found at <code>/usr/local/bin/rpm</code>, the build profile that includes the RPM
packaging will be activated. If <code>rpm</code> is available, but at a different path, then activate it by using
Maven's <code>-P</code> switch: <code>mvn -Pprm install</code>.</p>
<p>Alternatively, to build the tarball execute:</p>
<pre class="codehilite"><code>mvn clean install assembly:single
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.3.0
Build Date UTC : 2024-09-24 11:13:11.866444+00:00
-->
